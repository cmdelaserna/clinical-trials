<!-- Doc: http://getskeleton.com/ -->
<!-- d3 data: https://www.d3-graph-gallery.com/graph/basic_datamanipulation.html  -->
 <!-- D3 FILES & FLASK DATA: http://www.mydatastack.com/flaskd3part1 -->
 <!-- Color pallete: https://gka.github.io/palettes/ -->

<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Trials Explorer</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <!-- <script src="https://d3js.org/d3.v5.min.js"></script> -->
  <script src="{{ url_for('static', filename = 'd3js/d3.min.js') }}"></script>

  
  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">


  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="../static/css/normalize.css">
  <link rel="stylesheet" href="../static/css/skeleton.css">
  <link rel="stylesheet" href="../static/css/main.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <!-- <link rel="icon" type="image/png" href="images/favicon.png"> -->

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="twelve columns" style="margin-top: 3%">
        <h5><strong>Science Reports Lab</strong></h5>

  <!-- Form 
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
        <form action = "http://localhost:5000/result" method = "POST">
         <p>
          <input type = "text" name = "Search" id = "search-input" placeholder= "new search" />
          <input class = 'button' type = "submit" value = "submit" />
        </p>
        </form>
        <hr>
        </div>

  <!-- Results
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
            
    <!-- Summary -->
        <div class="twelve columns">
      {% for key, value in search.items() %}
      <p><strong>Summary: "{{value}}"</strong></p>
      <p>
      <code>
         Clinical Trials: {{number}} entries and {{source_number}} sources found
         {% endfor %}
     </code></p>
          <div id="svgTimeline"></div>
       </div>


  <!-- Graph: Phases
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
       <div class="twelve columns"  style='margin-top: 5%'>
        <hr>
          <p><strong>Clinical Trials by phase</strong></p>
          <div id="phase"></div>
    </div>

<!-- row -->    
</div>
<!-- container -->
</div>

<!-- d3 scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->


<!-- Stripes. Summary
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script>

// CHART: TIMELINE

    // Main data variables
    var timelineJSON = ({{ timeline | safe }});
    var timelineDataYear = Object.values(timelineJSON.year_submitted);
    var timelineData = Object.values(timelineJSON.nct_id);
    var timelineMax = d3.max(timelineData);
    console.log(timelineDataYear, timelineData, timelineMax);

    var years = [1999, 2019];

    // Chart variables
    var wTimeline = 400;
    var hTimeline = 40;
    var barPadding = 1;
    var color = '#ffa500';
    var gray = "#dfdfdf";


    // Scales
    var xScaleTimeline = d3.scaleLinear().range([0, wTimeline]);
    var yScaleTimeline = d3.scaleLinear().domain([0, timelineMax]).range([0, hTimeline]);

    // Color scales
    // var colorFill = d3.scaleLinear().domain([0,maxStripe]).range([gray, color]);
    // var colorOpacity = d3.scaleLinear().domain([0,maxStripe]).range([.3, 1]);

    // Div for the tooltip
    var div = d3.select("body")
                .append("div") 
                .attr("class", "tooltip")       
                .style("opacity", 0);

    // d3 chart
    var svgTimeline = d3.select("div#svgTimeline")
                        .append("svg")
                        .attr('width', wTimeline)
                        .attr('height', hTimeline);

    var rectTimeline = svgTimeline.selectAll('rect')
                        .data(timelineData)
                        .enter()
                        .append('rect');

    var attrTimeline = rectTimeline
                        .attr('width', wTimeline / timelineData.length - barPadding)
                        .attr('height', function(d) {return yScaleTimeline(d);})
                        .attr('x', function(d, i){ return i * (wTimeline / timelineData.length);})
                        .attr('y', function (d) {return hTimeline - yScaleTimeline(d);})
                        .attr('fill', color)
                        .on("mouseover", function(d) {    
                            div.transition()    
                                .duration(200)    
                                .style("opacity", .9);    
                            div .html(d + "<br/>"  + d)  
                                .style("left", (d3.event.pageX) - 10 + "px")   
                                .style("top", (d3.event.pageY - 40) + "px")  
                            })          
                        .on("mouseout", function(d) {   
                            div.transition()    
                                .duration(500)    
                                .style("opacity", 0); 
                        });
    
    // end of chart

    
    // BAR CHART (PHASES)

    // Data variables
    // var phase = {{ phase | safe }};
    // var dataPhase = Object.values(phase.nct_id);
    // var keysPhase = Object.values(phase.phase);  

    // variables
    // var wBar = 780;
    // var hBar = 200;
    // var maxPhase = d3.max(dataPhase);

    // chart
    // var yScaleBar = d3.scaleLinear().domain([0, maxPhase]).range([0, hBar]);

    // var svgPhase = d3.select("div#phase")
    //     .append("svg")
    //     .attr('width', wBar)
    //     .attr('height', hBar);

    // svgPhase.selectAll('rect')
    //   .data(dataPhase)
    //   .enter()
    //   .append('rect')
    //   .attr('width', wBar / dataPhase.length - barPadding)
    //   .attr('height', function(d) {return yScaleBar(d);})
    //   .attr('x', function(d, i){ return i * (wBar / dataPhase.length);})
    //   .attr('y', function (d) {return hBar - yScaleBar(d);})
    //   .attr('fill', color)
    //   .on("mouseover", function(d) {    
    //         div.transition()    
    //             .duration(200)    
    //             .style("opacity", .9);    
    //         div .html(d + "<br/>"  + d)  
    //             .style("left", (d3.event.pageX) + "px")   
    //             .style("top", (d3.event.pageY - 40) + "px")  
    //         })          
    //   .on("mouseout", function(d) {   
    //       div.transition()    
    //           .duration(500)    
    //           .style("opacity", 0); 
    //     });

    // end of chart


  </script>

  <!-- <script src="{{ url_for('static', filename = 'charts/graphs.js') }}"></script> -->

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
